<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tienda Morada</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    body {
      background: linear-gradient(135deg, #1f0035, #7e22ce);
      color: white;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    header {
      text-align: center;
      padding: 30px 0;
    }

    header h1 {
      font-size: 3em;
      background: linear-gradient(to right, #c084fc, #9333ea);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    header p {
      font-size: 1.2em;
      color: #e0caff;
    }

    .products {
      display: flex;
      gap: 30px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 40px;
      width: 100%;
      max-width: 1200px;
    }

    .product {
      background: linear-gradient(145deg, #2d004d, #4c1d95);
      border-radius: 25px;
      padding: 25px;
      width: 320px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.5);
      transition: transform 0.4s ease, box-shadow 0.3s;
      position: relative;
      display: flex;
      flex-direction: column;
    }

    .product:hover {
      transform: translateY(-10px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
    }

    .product img {
      width: 100%;
      border-radius: 15px;
      margin-bottom: 15px;
    }

    .product h2 {
      font-size: 1.8em;
      margin-bottom: 10px;
      color: #e9d5ff;
    }

    .price {
      font-size: 1.4em;
      margin: 10px 0;
      color: #facc15;
    }

    .old-price {
      font-size: 0.9em;
      text-decoration: line-through;
      color: #a78bfa;
    }

    .badge {
      position: absolute;
      top: 15px;
      right: 15px;
      background: #9333ea;
      color: white;
      padding: 6px 10px;
      border-radius: 12px;
      font-size: 0.8em;
    }

    label, select {
      display: block;
      margin: 10px 0 5px;
      font-size: 0.95em;
    }

    select, input[type=number] {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      border: none;
      background: #a855f7;
      color: white;
      margin-bottom: 10px;
      font-size: 1em;
    }

    button.add-btn {
      background: linear-gradient(to right, #a855f7, #9333ea);
      color: white;
      border: none;
      padding: 12px 20px;
      font-size: 1em;
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.3s ease;
      width: 100%;
      margin-top: auto;
    }

    button.add-btn:hover {
      background: linear-gradient(to right, #9333ea, #a855f7);
    }

    /* Carrito */

    #cart {
      position: fixed;
      top: 70px;
      right: 20px;
      width: 350px;
      max-height: 80vh;
      background: #4c1d95;
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.6);
      overflow-y: auto;
      color: white;
      display: none;
      z-index: 999;
    }

    #cart h3 {
      margin-bottom: 15px;
      text-align: center;
      font-size: 1.6em;
      color: #facc15;
    }

    .cart-item {
      margin-bottom: 12px;
      border-bottom: 1px solid #9333ea;
      padding-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .cart-item:last-child {
      border-bottom: none;
    }

    .cart-item img {
      width: 50px;
      height: 50px;
      object-fit: cover;
      border-radius: 10px;
      flex-shrink: 0;
    }

    .cart-item-text {
      flex-grow: 1;
      font-size: 1em;
      color: #e9d5ff;
    }

    #cart-total {
      font-weight: 700;
      font-size: 1.3em;
      margin-top: 10px;
      text-align: right;
      color: #facc15;
    }

    #envio-label {
      margin-top: 15px;
      font-weight: 600;
    }

    #envioTotal {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      border: none;
      background: #a855f7;
      color: white;
      margin-top: 5px;
      margin-bottom: 15px;
      font-size: 1em;
    }

    /* Bot√≥n carrito redondo con contador */
    .cart-toggle {
      position: fixed;
      top: 15px;
      right: 15px;
      background: #9333ea;
      border: none;
      color: white;
      width: 50px;
      height: 50px;
      font-size: 1.4em;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 1000;
      display: flex;
      justify-content: center;
      align-items: center;
      position: fixed;
    }

    .cart-count {
      position: absolute;
      top: 7px;
      right: 7px;
      background: #ff0000;
      color: white;
      font-weight: bold;
      font-size: 0.65em;
      padding: 1px 5px;
      border-radius: 50%;
      pointer-events: none;
      user-select: none;
      line-height: 1;
      min-width: 16px;
      text-align: center;
      box-sizing: border-box;
    }
.price {
  margin: 10px 0;
  color: #facc15;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.price .old-price {
  font-size: 0.9em;
  text-decoration: line-through;
  color: #a78bfa;
}

.price .current-price-wrapper {
  gap: 10px;
  flex-wrap: wrap;
}


.price .current-price {
  font-size: 1.4em;
  font-weight: bold;
}

.price .discount {
  font-size: 0.65em; /* o el tama√±o que prefieras */
  color: #f87171;
  font-weight: 600;
  vertical-align: middle;
  margin-left: 6px;
}

#product-container {
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
  justify-content: flex-start;
  padding: 10px;
}

.product {
  flex: 1 1 250px;
  max-width: 300px;
  padding: 10px;
  box-sizing: border-box;
  border-radius: 8px;
}

/*cupones*/

.coupon-panel-wrapper {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 1000;
}

#coupon-toggle {
  width: 45px;
  height: 45px;
  border-radius: 50%;
  background-color: #9333ea;
  color: white;
  font-size: 22px;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

.coupon-btn {
  background: linear-gradient(135deg, #a855f7, #9333ea);
  color: white;
  border: none;
  border-radius: 5px;
  padding: 6px 12px;
  cursor: pointer;
  margin-top: 5px;
}

.coupon-btn:disabled {
  background: #6b7280;
  cursor: not-allowed;
}

#coupon-panel {
  margin-top: 10px;
  background-color: #4c1d95;
  border: 2px solid #9333ea;
  padding: 12px;
  border-radius: 10px;
  width: 240px;
  box-shadow: 0 6px 15px rgba(0,0,0,0.5);
  color: white;
}

#coupon-list {
  list-style: none;
  padding: 0;
}

.coupon {
  border-bottom: 1px solid #6b528b;
  padding: 8px 0;
}

.coupon:last-child {
  border-bottom: none;
}

.timer {
  font-size: 0.85em;
  color: #f3e8ff;
  margin-top: 4px;
}

.hidden {
  display: none;
}

  </style>
</head>
<body>
  
  <header>
    <h1>Tienda Online</h1>
    <p>Billeteras de Hombre</p>
  </header>

<div class="coupon-panel-wrapper">
  <div id="coupon-panel" class="hidden">
    <h3 style="color:#facc15;">Cupones disponibles</h3>
    <ul id="coupon-list">
      <li id="coupon-weekly" class="coupon">
        <div>
          <strong>2.5% de descuento</strong><br>
          V√°lido por 48‚ÄØh
        </div>
        <button class="coupon-btn" id="claim-weekly">Reclamar</button>
        <div class="timer" id="timer-weekly">vencimiento: 48:00:00</div>
      </li>
      <li id="coupon-share" class="coupon">
        <div>
          <strong>1% por compartir</strong><br>
          V√°lido por 24‚ÄØh (se regenera cada 24‚ÄØh)
        </div>
        <button class="coupon-btn" id="claim-share">Reclamar</button>
        <div class="timer" id="timer-share">vencimiento: 24:00:00</div>
      </li>
    </ul>
  </div>
</div>



<div id="father-day-discount" style="
  background: linear-gradient(90deg, #f59e0b, #fbbf24);
  color: #1f2937;
  font-weight: 700;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  font-size: 16px;
  padding: 12px 20px;
  margin: 15px ;
  max-width: 320px;
  border-radius: 10px;
  text-align: center;
  box-shadow: 0 6px 15px rgba(245, 158, 11, 0.5);
  user-select: none;
  cursor: default;
  animation: pulseGlow 3s ease-in-out infinite;
">
  <span style="display: block; margin-bottom: 8px; font-size: 20px; color: #b45309;">
    üéÅ <strong>¬°Atenci√≥n RD!</strong>
  </span>
  Descuento <span style="color: #dc2626; font-size: 18px;">10.53%</span> <br>
  activo desde las <strong>12:00 AM</strong><br>
  del <strong>27 de julio</strong>.<br>
  <br>
  <span style="font-size: 18px; color: #dc2626; font-weight: 900;">
    Faltan <span id="father-day-timer"></span>
  </span><br>
  <small style="color: #92400e; font-style: italic; margin-top: 6px; display: block;">
    ¬°Est√©n atentos y aprovechen!
  </small>

  <script>
    (function () {
      const countdownSpan = document.getElementById("father-day-timer");
      const discountStartDate = new Date(2025, 6, 27, 0, 0, 0);

      function updateCountdown() {
        const now = new Date();
        let diff = discountStartDate - now;

        if (diff <= 0) {
          countdownSpan.textContent = "¬°El descuento est√° activo!";
          return;
        }

        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);

        countdownSpan.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
      }

      updateCountdown();
      setInterval(updateCountdown, 1000);
    })();
  </script>

  <style>
    @keyframes pulseGlow {
      0%, 100% {
        box-shadow: 0 0 8px 3px rgba(245, 158, 11, 0.6);
      }
      50% {
        box-shadow: 0 0 14px 6px rgba(245, 158, 11, 0.9);
      }
    }
  </style>
</div>

<!-- Arriba de todos los productos -->
<div id="discount"></div>

<div id="product-container">
  <div class="product" data-img="https://img.ltwebstatic.com/images3_spmp/2023/08/22/36/169271088231bfcdf82806be45938262b9159123a0_thumbnail_720x.jpg">
    <span class="badge">Popular</span>
    <img src="https://img.ltwebstatic.com/images3_spmp/2023/08/22/36/169271088231bfcdf82806be45938262b9159123a0_thumbnail_720x.jpg" alt="Cartera de Hombre" />
    <h2>Cartera de Hombre</h2>
    <div class="price">
      <span class="old-price">$5.00</span>
      <div class="current-price-wrapper">
        <span class="current-price" id="price1">$4.22</span>
        <span class="discount" id="discount1">(-15.53%)</span>
      </div>
    </div>
    <p>Stock: <span id="stock1">12</span></p>
    <label for="qty1">Cantidad:</label>
    <input id="qty1" type="number" min="1" max="12" value="1" />
    <button class="add-btn" onclick="addToCart('p1', 'Cartera de Hombre', 4.22, 'qty1', 'stock1', this)">Agregar al carrito</button>
  </div>

  <div class="product" data-img="https://img.ltwebstatic.com/images3_spmp/2023/11/29/d5/1701248613da37108e4da7531a98581bb09ae55015_thumbnail_720x.jpg">
    <span class="badge">Nuevo</span>
    <img src="https://img.ltwebstatic.com/images3_spmp/2023/11/29/d5/1701248613da37108e4da7531a98581bb09ae55015_thumbnail_720x.jpg" alt="Cartera de Hombre" />
    <h2>Cartera de Hombre</h2>
    <div class="price">
      <span class="old-price">$5.50</span>
      <div class="current-price-wrapper">
        <span class="current-price" id="price2">$4.17</span>
        <span class="discount" id="discount2">(-24.13%)</span>
      </div>
    </div>
    <p>Stock: <span id="stock2">2</span></p>
    <label for="qty2">Cantidad:</label>
    <input id="qty2" type="number" min="1" max="2" value="1" />
    <button class="add-btn" onclick="addToCart('p2', 'Cartera de Hombre', 4.17, 'qty2', 'stock2', this)">Agregar al carrito</button>
  </div>


  <div class="product" data-img="https://m.media-amazon.com/images/I/81dfPbcOPrL._AC_SL1500_.jpg">
    <span class="badge">Nuevo</span>
    <img src="https://m.media-amazon.com/images/I/81dfPbcOPrL._AC_SL1500_.jpg" alt="Cartera de Hombre" />
    <h2>Domino</h2>
    <div class="price">
      <span class="old-price">$6.21</span>
      <div class="current-price-wrapper">
        <span class="current-price" id="price2">$5.78</span>
        <span class="discount" id="discount2">(-11.4%)</span>
      </div>
    </div>
    <p>Stock: <span id="stock3">2</span></p>
    <label for="qty3">Cantidad:</label>
    <input id="qty3" type="number" min="1" max="2" value="1" />
    <button class="add-btn" onclick="addToCart('p3', 'Domino', 5.78, 'qty3', 'stock3', this)">Agregar al carrito</button>
  </div>
</div>

</div>

  

  <!-- Bot√≥n carrito -->
  <button class="cart-toggle" onclick="toggleCart()">
    üõí
    <span class="cart-count" id="cart-count">0</span>
  </button>

  <!-- Carrito -->
  <div id="cart">
    <h3>Tu carrito</h3>
    <div id="cart-items"></div>

    <label id="envio-label" for="envioTotal">Costo de env√≠o:</label>
    <select id="envioTotal" onchange="updateTotal()">
      <option value="0">No env√≠o (Retiro en tienda) - $0</option>
      <option value="1">Env√≠o (+$1.00)</option>
    </select>

    <p id="cart-total">Total: $0.00</p>

    <form id="paypal-form" action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank" onsubmit="return validateCart()">
      <input type="hidden" name="cmd" value="_xclick" />
      <input type="hidden" name="business" value="trotoliso@gmail.com" />
      <input type="hidden" name="currency_code" value="USD" />
      <input type="hidden" id="item_name" name="item_name" value="" />
      <input type="hidden" id="amount" name="amount" value="0" />
      <input type="submit" value="Pagar con PayPal" style="
        background: #9333ea;
        border: none;
        padding: 12px 20px;
        color: white;
        border-radius: 12px;
        font-weight: 700;
        font-size: 1.1em;
        cursor: pointer;
        width: 100%;
        margin-top: 15px;
      " />
    </form>
  </div>
  
 <script>
  let cartItems = [];

  // Cargar carrito guardado en localStorage al inicio
  window.onload = function() {
    const savedCart = localStorage.getItem('cartItems');
    if (savedCart) {
      cartItems = JSON.parse(savedCart);
      // Actualizar stock y UI seg√∫n lo guardado
      cartItems.forEach(item => {
        const index = getIndexFromId(item.id);
        const stockEl = document.getElementById(`stock${index}`);
        const qtyInput = document.getElementById(`qty${index}`);
        const btn = document.querySelector(`button.add-btn[onclick*="'${item.id}'"]`);

        if (stockEl && qtyInput && btn) {
          if (!stockEl.getAttribute("data-initial-stock")) {
            stockEl.setAttribute("data-initial-stock", stockEl.textContent);
          }
          const initialStockRaw = stockEl.getAttribute("data-initial-stock");
          const initialStock = isNaN(parseInt(initialStockRaw)) ? 0 : parseInt(initialStockRaw);

          const newStock = initialStock - item.qty;
          stockEl.textContent = newStock >= 0 ? newStock : 0;

          qtyInput.max = newStock >= 0 ? newStock : 0;
          if (newStock <= 0) {
            qtyInput.value = 0;
            qtyInput.disabled = true;
            btn.disabled = true;
            btn.textContent = "Sin stock";
            btn.style.background = "#6b7280";
            btn.style.cursor = "not-allowed";
          } else {
            qtyInput.disabled = false;
            btn.disabled = false;
            btn.textContent = "Agregar al carrito";
            btn.style.background = "";
            btn.style.cursor = "pointer";
          }
        }
      });
      updateCart();
      updateCartCount();
    }
  };

  function saveCart() {
    localStorage.setItem('cartItems', JSON.stringify(cartItems));
  }

  function addToCart(id, name, price, qtyInputId, stockId, btn) {
    const qtyInput = document.getElementById(qtyInputId);
    const stockEl = document.getElementById(stockId);

    if (!stockEl.getAttribute("data-initial-stock")) {
      stockEl.setAttribute("data-initial-stock", stockEl.textContent);
    }

    let requestedQty = parseInt(qtyInput.value);
    if (isNaN(requestedQty) || requestedQty < 1) {
      requestedQty = 0;
    }

    const initialStockRaw = stockEl.getAttribute("data-initial-stock");
    const initialStock = isNaN(parseInt(initialStockRaw)) ? 0 : parseInt(initialStockRaw);

    const existingItem = cartItems.find(item => item.id === id);
    const alreadyInCart = existingItem ? existingItem.qty : 0;
    const availableStock = initialStock - alreadyInCart;

    if (requestedQty === 0) {
      alert("Cantidad inv√°lida o cero");
      return;
    }

    if (requestedQty > availableStock) {
      alert("No hay suficiente stock");
      return;
    }

    if (existingItem) {
      existingItem.qty += requestedQty;
    } else {
      const productDiv = btn.closest('.product');
      const imgSrc = productDiv ? productDiv.getAttribute('data-img') || '' : '';
      cartItems.push({ id, name, price, qty: requestedQty, img: imgSrc });
    }

    const totalQtyInCart = cartItems.find(item => item.id === id).qty;
    const newStock = initialStock - totalQtyInCart;

    stockEl.textContent = newStock >= 0 ? newStock : 0;
    qtyInput.max = newStock >= 0 ? newStock : 0;

    if (newStock <= 0) {
      qtyInput.value = 0;
      qtyInput.disabled = true;
      btn.disabled = true;
      btn.textContent = "Sin stock";
      btn.style.background = "#6b7280";
      btn.style.cursor = "not-allowed";
    }

    updateCart();
    updateCartCount();
    saveCart();
  }

  function getIndexFromId(id) {
    return id.replace(/\D/g, '');
  }

  function incrementQty(id) {
    const item = cartItems.find(i => i.id === id);
    if (!item) return;

    const index = getIndexFromId(id);
    const stockEl = document.getElementById(`stock${index}`);
    const qtyInput = document.getElementById(`qty${index}`);
    const addBtn = document.querySelector(`button.add-btn[onclick*="'${id}'"]`);

    const initialStockRaw = stockEl.getAttribute("data-initial-stock");
    const initialStock = isNaN(parseInt(initialStockRaw)) ? 0 : parseInt(initialStockRaw);

    if (item.qty < initialStock) {
      item.qty++;
      const newStock = initialStock - item.qty;

      stockEl.textContent = newStock >= 0 ? newStock : 0;
      qtyInput.max = newStock >= 0 ? newStock : 0;

      if (newStock <= 0) {
        qtyInput.disabled = true;
        addBtn.disabled = true;
        addBtn.textContent = "Sin stock";
        addBtn.style.background = "#6b7280";
        addBtn.style.cursor = "not-allowed";
      } else {
        qtyInput.disabled = false;
        addBtn.disabled = false;
        addBtn.textContent = "Agregar al carrito";
        addBtn.style.background = "";
        addBtn.style.cursor = "pointer";
      }

      updateCart();
      updateCartCount();
      saveCart();
    } else {
      alert("No hay m√°s stock disponible");
    }
  }

  function decrementQty(id) {
    const item = cartItems.find(i => i.id === id);
    if (!item) return;

    const index = getIndexFromId(id);
    const stockEl = document.getElementById(`stock${index}`);
    const qtyInput = document.getElementById(`qty${index}`);
    const addBtn = document.querySelector(`button.add-btn[onclick*="'${id}'"]`);

    const initialStockRaw = stockEl.getAttribute("data-initial-stock");
    const initialStock = isNaN(parseInt(initialStockRaw)) ? 0 : parseInt(initialStockRaw);

    item.qty--;

    if (item.qty <= 0) {
      removeFromCart(id);
    } else {
      const newStock = initialStock - item.qty;
      stockEl.textContent = newStock >= 0 ? newStock : 0;

      qtyInput.max = newStock >= 0 ? newStock : 0;
      qtyInput.disabled = false;
      addBtn.disabled = false;
      addBtn.textContent = "Agregar al carrito";
      addBtn.style.background = "";
      addBtn.style.cursor = "pointer";

      updateCart();
      updateCartCount();
      saveCart();
    }
  }

  function removeFromCart(productId) {
    const item = cartItems.find(i => i.id === productId);
    if (!item) return;

    const index = getIndexFromId(productId);
    const stockEl = document.getElementById(`stock${index}`);
    const qtyInput = document.getElementById(`qty${index}`);
    const btn = document.querySelector(`button.add-btn[onclick*="'${productId}'"]`);

    if (stockEl && qtyInput && btn) {
      const initialStockRaw = stockEl.getAttribute("data-initial-stock");
      const initialStock = isNaN(parseInt(initialStockRaw)) ? 0 : parseInt(initialStockRaw);
      const currentStock = parseInt(stockEl.textContent) || 0;
      const restoredStock = currentStock + item.qty;

      stockEl.textContent = restoredStock > initialStock ? initialStock : restoredStock;
      qtyInput.disabled = false;
      qtyInput.max = stockEl.textContent;
      btn.disabled = false;
      btn.textContent = "Agregar al carrito";
      btn.style.background = "";
      btn.style.cursor = "pointer";
    }

    cartItems = cartItems.filter(i => i.id !== productId);

    updateCart();
    updateCartCount();
    saveCart();
  }

  // Vaciar todo el carrito
  function clearCart() {
    if (!confirm("¬øSeguro que quieres vaciar el carrito?")) return;

    cartItems.forEach(item => {
      const index = getIndexFromId(item.id);
      const stockEl = document.getElementById(`stock${index}`);
      const qtyInput = document.getElementById(`qty${index}`);
      const btn = document.querySelector(`button.add-btn[onclick*="'${item.id}'"]`);
      if (stockEl && qtyInput && btn) {
        const initialStockRaw = stockEl.getAttribute("data-initial-stock");
        const initialStock = isNaN(parseInt(initialStockRaw)) ? 0 : parseInt(initialStockRaw);
        stockEl.textContent = initialStock;
        qtyInput.value = 1;
        qtyInput.disabled = false;
        qtyInput.max = initialStock;
        btn.disabled = false;
        btn.textContent = "Agregar al carrito";
        btn.style.background = "";
        btn.style.cursor = "pointer";
      }
    });

    cartItems = [];
    updateCart();
    updateCartCount();
    saveCart();
  }

  function updateCart() {
    const cartItemsContainer = document.getElementById("cart-items");
    cartItemsContainer.innerHTML = "";

    cartItems.forEach(item => {
      const div = document.createElement("div");
      div.classList.add("cart-item");
      div.innerHTML = `
        <img src="${item.img}" alt="${item.name}" />
        <div class="cart-item-text">${item.name}</div>
        <button onclick="decrementQty('${item.id}')" title="Disminuir" style="
          background: transparent;
          border: none;
          color: #facc15;
          font-weight: bold;
          font-size: 1.5em;
          cursor: pointer;
          flex-shrink: 0;
          width: 30px;
        ">‚àí</button>
        <span style="min-width: 20px; text-align: center;">${item.qty}</span>
        <button onclick="incrementQty('${item.id}')" title="Aumentar" style="
          background: transparent;
          border: none;
          color: #facc15;
          font-weight: bold;
          font-size: 1.5em;
          cursor: pointer;
          flex-shrink: 0;
          width: 30px;
        ">+</button>
        <span style="margin-left: auto; font-weight: 700;">$${(item.price * item.qty).toFixed(2)}</span>
      `;
      cartItemsContainer.appendChild(div);
    });

    // Bot√≥n para vaciar carrito
    const cartDiv = document.getElementById("cart");
    let clearBtn = document.getElementById("clear-cart-btn");
    if (cartItems.length > 0) {
      if (!clearBtn) {
        clearBtn = document.createElement("button");
        clearBtn.id = "clear-cart-btn";
        clearBtn.textContent = "Vaciar carrito";
        clearBtn.style.marginTop = "10px";
        clearBtn.style.background = "#ef4444";
        clearBtn.style.color = "white";
        clearBtn.style.border = "none";
        clearBtn.style.padding = "8px 15px";
        clearBtn.style.cursor = "pointer";
        clearBtn.style.borderRadius = "5px";
        clearBtn.onclick = clearCart;
        cartDiv.appendChild(clearBtn);
      }
    } else {
      if (clearBtn) clearBtn.remove();
    }

    updateTotal();
  }

  function updateCartCount() {
    const countEl = document.getElementById("cart-count");
    const totalQty = cartItems.reduce((sum, item) => sum + item.qty, 0);
    countEl.textContent = totalQty;
    countEl.style.display = totalQty > 0 ? "inline-block" : "none";
  }

  function updateTotal() {
    const envioSelect = document.getElementById("envioTotal");
    const envioCost = parseFloat(envioSelect.value) || 0;

    let subtotal = cartItems.reduce((sum, item) => sum + item.price * item.qty, 0);
    let total = subtotal + envioCost;

    document.getElementById("cart-total").textContent = `Total: $${total.toFixed(2)}`;

    const itemNames = cartItems.map(item => `${item.name} x${item.qty}`).join(', ');
    document.getElementById("item_name").value = itemNames;
    document.getElementById("amount").value = total.toFixed(2);
  }

  function toggleCart() {
    const cart = document.getElementById("cart");
    cart.style.display = cart.style.display === "block" ? "none" : "block";
  }

  function validateCart() {
    if (cartItems.length === 0) {
      alert("El carrito est√° vac√≠o");
      return false;
    }
    return true;
  }

  // Funci√≥n para mostrar porcentaje de descuento peque√±o junto al precio
  function showDiscountPercent(priceId, oldPriceSelector, discountId) {
    const priceEl = document.getElementById(priceId);
    const oldPriceEl = document.querySelector(oldPriceSelector);
    const discountEl = document.getElementById(discountId);

    if (!priceEl || !oldPriceEl || !discountEl) return;

    const oldPriceText = oldPriceEl.textContent.replace(/[^\d.,]/g, '').replace(',', '.');
    const priceText = priceEl.textContent.replace(/[^\d.,]/g, '').replace(',', '.');

    const oldPrice = parseFloat(oldPriceText);
    const price = parseFloat(priceText);

    if (isNaN(oldPrice) || isNaN(price) || oldPrice <= price) {
      discountEl.textContent = "";
      return;
    }

    const discount = Math.round(((oldPrice - price) / oldPrice) * 100);
    discountEl.textContent = ` -${discount}%`;
  }

  // Mostrar descuentos en la p√°gina
  showDiscountPercent("price1", "#oldprice1", "discount1");
  showDiscountPercent("price2", "#oldprice2", "discount2");
</script>
<script>
  // Fecha l√≠mite para el descuento (ejemplo: 21 de junio 2025 23:59:59)
  const discountEndDate = new Date("2025-06-21T23:59:59").getTime();

  function updateCountdown() {
    const now = new Date().getTime();
    const distance = discountEndDate - now;

    if (distance < 0) {
      document.getElementById("discount-countdown").textContent = "El descuento del D√≠a del Padre ha finalizado.";
      clearInterval(countdownInterval);
      // Opcional: aqu√≠ puedes remover o desactivar el descuento en los productos
      removeDiscountFromProducts();
      return;
    }

    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((distance % (1000 * 60)) / 1000);

    document.getElementById("discount-countdown").textContent = 
      `Descuento D√≠a del Padre 10.53% v√°lido por: ${days}d ${hours}h ${minutes}m ${seconds}s`;
  }

  // Aplicar descuento en cada producto y mostrar precio con descuento
  function applyDiscountToProducts() {
    const discountPercent = 10.53;

    // Supongamos que tus precios tienen la clase 'price' y el precio original est√° en 'data-price-original'
    document.querySelectorAll('.product').forEach(product => {
      const priceEl = product.querySelector('.price');
      if (!priceEl) return;

      // Guardamos el precio original en un atributo para no perderlo
      if (!priceEl.hasAttribute('data-price-original')) {
        let originalPriceText = priceEl.textContent.replace(/[^\d.,]/g, '').replace(',', '.');
        priceEl.setAttribute('data-price-original', originalPriceText);
      }

      const originalPrice = parseFloat(priceEl.getAttribute('data-price-original'));
      if (isNaN(originalPrice)) return;

      const discountedPrice = (originalPrice * (1 - discountPercent / 100)).toFixed(2);

      priceEl.textContent = `$${discountedPrice}`;

      // Mostrar el porcentaje de descuento al lado
      let discountTag = product.querySelector('.discount-tag');
      if (!discountTag) {
        discountTag = document.createElement('span');
        discountTag.className = 'discount-tag';
        discountTag.style.color = '#ef4444';
        discountTag.style.fontWeight = 'bold';
        discountTag.style.marginLeft = '5px';
        product.querySelector('.price').after(discountTag);
      }
      discountTag.textContent = `-10.53%`;
    });
  }

  // Opcional: funci√≥n para remover descuento cuando se acabe la promo
  function removeDiscountFromProducts() {
    document.querySelectorAll('.product').forEach(product => {
      const priceEl = product.querySelector('.price');
      if (!priceEl) return;

      const originalPrice = priceEl.getAttribute('data-price-original');
      if (originalPrice) {
        priceEl.textContent = `$${parseFloat(originalPrice).toFixed(2)}`;
      }

      const discountTag = product.querySelector('.discount-tag');
      if (discountTag) discountTag.remove();
    });
  }

  // Actualizar el contador cada segundo
  updateCountdown();
  const countdownInterval = setInterval(updateCountdown, 1000);

  // Aplicar descuento al cargar la p√°gina
  applyDiscountToProducts();
</script>

<script>
  const weeklyKey = 'coupon_weekly_time';
  const shareKey = 'coupon_share_time';

  const claimWeekly = document.getElementById('claim-weekly');
  const claimShare = document.getElementById('claim-share');
  const timerWeekly = document.getElementById('timer-weekly');
  const timerShare = document.getElementById('timer-share');

  function formatTime(ms) {
    const totalSec = Math.floor(ms/1000);
    const h = String(Math.floor(totalSec/3600)).padStart(2,'0');
    const m = String(Math.floor((totalSec%3600)/60)).padStart(2,'0');
    const s = String(totalSec%60).padStart(2,'0');
    return `${h}:${m}:${s}`;
  }

  function updateTimers(){
    const now = Date.now();

    // semanal 48h
    const wTime = parseInt(localStorage.getItem(weeklyKey)) || 0;
    const wRemain = wTime > now ? wTime - now : 0;
    if (wRemain>0) {
      timerWeekly.textContent = `vencimiento: ${formatTime(wRemain)}`;
      claimWeekly.disabled = true;
    } else {
      timerWeekly.textContent = `vencimiento: listo`;
      claimWeekly.disabled = false;
    }

    // compartir 24h
    const sTime = parseInt(localStorage.getItem(shareKey)) || 0;
    const sRemain = sTime > now ? sTime - now : 0;
    if (sRemain>0) {
      timerShare.textContent = `vencimiento: ${formatTime(sRemain)}`;
      claimShare.disabled = true;
    } else {
      timerShare.textContent = `vencimiento: listo`;
      claimShare.disabled = false;
    }
  }

  claimWeekly.addEventListener('click', ()=>{
    const expire = Date.now() + 48*3600*1000;
    localStorage.setItem(weeklyKey, expire);
    applyCoupon(0.025, 'Semanal 2.5%');
    updateTimers();
  });

  claimShare.addEventListener('click', ()=>{
    const expire = Date.now() + 24*3600*1000;
    localStorage.setItem(shareKey, expire);
    applyCoupon(0.01, 'Compartir 1%');
    updateTimers();
    // tambi√©n se podr√≠a copiar enlace al portapapeles
  });

  function applyCoupon(rate, desc) {
    alert(`Cup√≥n aplicado: ${desc}`);
    // si usas subtotal + env√≠o, aqu√≠ puedes recalcular total
    // ejemplo: cartTotal = cartTotal * (1 - rate)
    // y actualizar UI y Paypal form
  }

  // abrir/cerrar panel
  document.getElementById('coupon-toggle').addEventListener('click', () => {
    document.getElementById('coupon-panel').classList.toggle('hidden');
  });

  setInterval(updateTimers,1000);
  updateTimers();
</script>




</body>
</html>
